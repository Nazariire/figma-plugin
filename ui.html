<script>
  window.onmessage = async (event) => {
    if (event.data.pluginMessage.type === 'networkRequest') {
      var request = new XMLHttpRequest()
      console.log(event.data.pluginMessage);
      request.open('GET', `${event.data.pluginMessage.tolgeeConfig.url}/v2/projects/translations/${event.data.pluginMessage.tolgeeConfig.lang}`)
      request.setRequestHeader("Content-Type", "application/json")
      request.setRequestHeader("X-API-Key", event.data.pluginMessage.tolgeeConfig.apiKey);
      request.responseType = 'json'
      request.onload = () => {
        window.parent.postMessage({pluginMessage: request.response[event.data.pluginMessage.tolgeeConfig.lang]}, '*')
      };
      request.send()
    } else if (event.data.pluginMessage.type === "updateKey" && event.data.pluginMessage.key) {
      var request = new XMLHttpRequest()
      request.open('POST', `${event.data.pluginMessage.tolgeeConfig.url}/v2/projects/translations`)
      request.setRequestHeader("X-API-Key", event.data.pluginMessage.tolgeeConfig.apiKey);
      request.setRequestHeader("Content-Type", "application/json")
      request.responseType = 'json';
      request.onload = () => {
        window.parent.postMessage({pluginMessage: { key: request.response.keyName, value: request.response.translations[event.data.pluginMessage.tolgeeConfig.lang].text, node: event.data.pluginMessage.node}}, '*')
      };
      request.send(JSON.stringify({
        "key": event.data.pluginMessage.key,
        "translations":  {
          [event.data.pluginMessage.tolgeeConfig.lang]: event.data.pluginMessage.value
        },
        "languagesToReturn": [event.data.pluginMessage.tolgeeConfig.lang]
      }))
    }
  }

  function save() {
    const url = document.getElementById("url").value;
    const apiKey = document.getElementById("apiKey").value;
    const lang = document.getElementById("lang").value;
    window.parent.postMessage({ pluginMessage: { url, apiKey, lang } }, '*');
  }
</script>
<div style="width: 100%; height: 100%; display: flex; flex-direction: column; gap: 8px;">
  <h1>Tolgee Setup</h1>
  <label for="url">Tolgee URL
  </label>
  <input id="url">
  <label for="apiKey">Tolgee API-Key
  </label>
  <input id="apiKey">
  <label for="lang">Language-slug
  </label>
  <input id="lang">
  <button onclick="save()">Save</button>
</div>

<style>
  input, button {
    background: transparent;
    box-shadow: none;
    border-radius: 4px;
    padding: 8px 4px;
    border: 1px solid black;
    color: black;
  }
  @media (prefers-color-scheme: dark) {
    * {
      color: white;
    }
    input, button {
      border: 1px solid white;
      color: white;
    }
  }
</style>